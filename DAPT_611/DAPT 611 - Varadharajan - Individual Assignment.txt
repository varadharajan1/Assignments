/**
 * First name : Varadharajan
 * Last name  : Sethuraman
 * Student ID : V00937226
 * Individual Homework on BIGPV
 */

/*1. Display All Orders In 2009*/
SELECT * FROM ORDER_T O WHERE EXTRACT(YEAR FROM O.ORDERDATE) = 2009


/*2. Display All Customers Who Have Placed At Least One Order In 2009*/
SELECT C.CUSTOMERID, C.CUSTOMERNAME, O.ORDERID, O.ORDERDATE FROM CUSTOMER_T C, ORDER_T O WHERE C.CUSTOMERID=O.CUSTOMERID AND EXTRACT(YEAR FROM O.ORDERDATE) = 2009 ORDER BY C.CUSTOMERID, C.CUSTOMERNAME


/*3. Display The Description Of All Products Sold In 2009*/
SELECT DISTINCT P.PRODUCTID, P.PRODUCTDESCRIPTION, P.PRODUCTSTANDARDPRICE 
FROM PRODUCT_T P, ORDER_T O, ORDERLINE_T OL 
WHERE P.PRODUCTID=OL.PRODUCTID 
AND OL.ORDERID=O.ORDERID
AND EXTRACT(YEAR FROM O.ORDERDATE) = 2009 
ORDER BY P.PRODUCTID;


/*4. Display All Customers In Each Territory*/
SELECT T.TERRITORYID, T.TERRITORYNAME, D.CUSTOMERID FROM DOESBUSINESSIN_T D, TERRITORY_T T WHERE D.TERRITORYID=T.TERRITORYID;


/*5. Display All Customers And Salespersons In Each Territory*/
SELECT D.TERRITORYID, S.SALESTERRITORYID, S.SALESPERSONNAME, C.CUSTOMERID, C.CUSTOMERNAME 
FROM CUSTOMER_T C, DOESBUSINESSIN_T D, SALESPERSON_T S 
WHERE C.CUSTOMERID=D.CUSTOMERID 
AND D.TERRITORYID=S.SALESTERRITORYID
ORDER BY C.CUSTOMERID;


/*6. Display The Order Lines Of Each Order*/
SELECT OL.ORDERID, OL.PRODUCTID, P.PRODUCTSTANDARDPRICE, OL.ORDEREDQUANTITY 
FROM ORDERLINE_T OL, PRODUCT_T P 
WHERE P.PRODUCTID=OL.PRODUCTID 
ORDER BY OL.ORDERID;


/*7. Display The Order Lines Of Each Order For Each Customer*/
SELECT O.CUSTOMERID, OL.ORDERID, OL.PRODUCTID, OL.ORDEREDQUANTITY, P.PRODUCTSTANDARDPRICE 
FROM ORDER_T O, ORDERLINE_T OL, PRODUCT_T P 
WHERE O.ORDERID=OL.ORDERID
AND P.PRODUCTID=OL.PRODUCTID 
ORDER BY O.CUSTOMERID, OL.ORDERID, OL.PRODUCTID;


/*8. Display All Customer Orders For Each Territory*/
SELECT D.TERRITORYID, T.TERRITORYNAME, D.CUSTOMERID, O.ORDERID 
FROM TERRITORY_T T, DOESBUSINESSIN_T D, ORDER_T O 
WHERE D.TERRITORYID=T.TERRITORYID
AND D.CUSTOMERID=O.CUSTOMERID
ORDER BY T.TERRITORYNAME, D.CUSTOMERID, O.ORDERID;


/*9. Display The Order Lines Of Each Order By Customers In Each Territory*/
SELECT D.TERRITORYID, T.TERRITORYNAME, D.CUSTOMERID, O.ORDERID, OL.PRODUCTID 
FROM TERRITORY_T T, DOESBUSINESSIN_T D, ORDER_T O, ORDERLINE_T OL 
WHERE D.TERRITORYID=T.TERRITORYID
AND D.CUSTOMERID=O.CUSTOMERID
AND O.ORDERID=OL.ORDERID
ORDER BY T.TERRITORYNAME, D.CUSTOMERID, OL.ORDERID;


/*10. Display The Standard Price Of Each Product And Quantity Ordered For Each Order In A Territory.*/
SELECT D.TERRITORYID, T.TERRITORYNAME, D.CUSTOMERID, O.ORDERID, P.PRODUCTID, OL.ORDEREDQUANTITY, P.PRODUCTSTANDARDPRICE 
FROM TERRITORY_T T, DOESBUSINESSIN_T D, ORDER_T O, PRODUCT_T P, ORDERLINE_T OL 
WHERE D.TERRITORYID=T.TERRITORYID
AND D.CUSTOMERID=O.CUSTOMERID
AND O.ORDERID=OL.ORDERID
AND P.PRODUCTID=OL.PRODUCTID
ORDER BY T.TERRITORYNAME, D.CUSTOMERID, OL.ORDERID;


/*11. Display The Total Price Of Each Order*/
SELECT ORDERID, SUM(SUBTOTAL) AS TOTALPRICE 
FROM 
(SELECT OL.ORDERID, (OL.ORDEREDQUANTITY * P.PRODUCTSTANDARDPRICE) AS SUBTOTAL 
FROM ORDERLINE_T OL, PRODUCT_T P
WHERE OL.PRODUCTID = P.PRODUCTID) 
GROUP BY ORDERID
ORDER BY ORDERID;


/*12. Display The Subtotal Price Of Each Product In An Order In Each Territory*/
SELECT T.TERRITORYID, T.TERRITORYNAME, O.CUSTOMERID, OL.ORDERID, P.PRODUCTID, OL.ORDEREDQUANTITY, P.PRODUCTSTANDARDPRICE, (OL.ORDEREDQUANTITY * P.PRODUCTSTANDARDPRICE) AS SUBTOTALPRICE 
FROM TERRITORY_T T, DOESBUSINESSIN_T D, ORDER_T O, ORDERLINE_T OL, PRODUCT_T P 
WHERE T.TERRITORYID=D.TERRITORYID
AND D.CUSTOMERID=O.CUSTOMERID
AND O.ORDERID=OL.ORDERID
AND P.PRODUCTID=OL.PRODUCTID
ORDER BY T.TERRITORYNAME, O.CUSTOMERID, OL.ORDERID;


/*13. Display The Total Amount Of Sales In Each Territory*/
SELECT TERRITORYID, SUM(SUBTOTALPRICE) AS TOTALSALESBYTERRITORY FROM (
SELECT D.TERRITORYID, (OL.ORDEREDQUANTITY * P.PRODUCTSTANDARDPRICE) AS SUBTOTALPRICE 
FROM DOESBUSINESSIN_T D, ORDER_T O, ORDERLINE_T OL, PRODUCT_T P
WHERE D.CUSTOMERID=O.CUSTOMERID
AND O.ORDERID=OL.ORDERID
AND OL.PRODUCTID=P.PRODUCTID) 
GROUP BY TERRITORYID
ORDER BY TERRITORYID;
