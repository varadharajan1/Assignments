/**
 * First name : Varadharajan
 * Last name  : Sethuraman
 * Student ID : V00937226
 * Part 2: Individual Exam on BIGPV
 */

/*a. Display the total cost of each raw material used in a product; each raw material cost is multiplied by the quantity required.*/

SELECT P.PRODUCTID, P.PRODUCTSTANDARDPRICE, R.MATERIALID, R.MATERIALSTANDARDPRICE, U.QUANTITYREQUIRED, (R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS TOTALCOSTPERRAWMATERIAL 
FROM PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID 
ORDER BY P.PRODUCTID;

/*b. Display the standard price of each product and its total raw material cost*/

SELECT PRODUCTID, PRODUCTSTANDARDPRICE, SUM(TOTALRAWCOSTPERPRODUCT) FROM 
(
SELECT P.PRODUCTID, P.PRODUCTSTANDARDPRICE, (R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS TOTALRAWCOSTPERPRODUCT 
FROM PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID
)
GROUP BY PRODUCTID, PRODUCTSTANDARDPRICE
ORDER BY PRODUCTID;


SELECT P.PRODUCTID, P.PRODUCTSTANDARDPRICE, SUM(R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS TOTALRAWCOSTPERPRODUCT 
FROM PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID
GROUP BY P.PRODUCTID, P.PRODUCTSTANDARDPRICE
ORDER BY P.PRODUCTID;

/*c. Display the profit of each product.*/
SELECT PRODUCTID, PRODUCTSTANDARDPRICE, SUM(TOTALRAWCOSTPERPRODUCT) AS RAWCOST, (PRODUCTSTANDARDPRICE - SUM(TOTALRAWCOSTPERPRODUCT)) AS PROFIT FROM 
(
SELECT P.PRODUCTID, P.PRODUCTSTANDARDPRICE, (R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS TOTALRAWCOSTPERPRODUCT 
FROM PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID
)
GROUP BY PRODUCTID, PRODUCTSTANDARDPRICE
ORDER BY PRODUCTID


SELECT P.PRODUCTID, P.PRODUCTSTANDARDPRICE, SUM(R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS RAWCOST,  (P.PRODUCTSTANDARDPRICE - SUM(R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED)) AS PROFIT 
FROM PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID
GROUP BY P.PRODUCTID, P.PRODUCTSTANDARDPRICE
ORDER BY P.PRODUCTID

/*d. Display the total raw material cost of each order*/
SELECT ORDERID, SUM(RAWMATERIALPERPRODUCT * ORDEREDQUANTITY) AS TOTALMATERIALCOSTOFEACHORDER FROM 
( 
SELECT OL.ORDERID, OL.PRODUCTID, OL.ORDEREDQUANTITY, R.MATERIALID, R.MATERIALSTANDARDPRICE, U.QUANTITYREQUIRED, (R.MATERIALSTANDARDPRICE * U.QUANTITYREQUIRED) AS RAWMATERIALPERPRODUCT 
FROM ORDERLINE_T OL, PRODUCT_T P, RAWMATERIAL_T R, USES_T U 
WHERE OL.PRODUCTID=P.PRODUCTID
AND P.PRODUCTID=U.PRODUCTID
AND U.MATERIALID=R.MATERIALID 
)
GROUP BY ORDERID
ORDER BY ORDERID;


